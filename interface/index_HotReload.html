<!DOCTYPE html>
<html lang="en">
  <head>
    <!--HTMLページの開発や調整を行うときはこのページを利用することで擬似的にホットリロードを行えます-->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>[HotReload Enabled]Dashboard</title>
    <style>
      html {
        height: 100%;
        margin: 0px;
        overflow: hidden;
        background-image: linear-gradient(135deg, rgba(0, 0, 0, 0.05) 25%, transparent 25%, transparent 50%, rgba(0, 0, 0, 0.05) 50%, rgba(0, 0, 0, 0.05) 75%, transparent 75%, transparent);
        background-size: 10px 10px;
      }
      body {
        height: 100%;
        margin: 0px;
      }
      head {
        height: 100%;
        margin: 0px;
      }
    </style>
  </head>
  <body>
    <iframe src="./index.html" frameborder="0" width="100%" height="100%" id="main_iframe"></iframe>
    <script>
      // ここでPythonのコードを擬似的に再現する（読み込み関連部のみで良い）
      // Iframeでindex.htmlを呼び出し、このコードから操作を行う。
      // LiveServerの利用を強く推奨する
      const dummy_settings = {
        description: {
          interface: {
            update_interval_sec: "グラフの描画間隔を指定します。数値を小さくすると、高頻度に更新されますが、端末の負荷が上昇します。単位は秒。",
            graph_max_display: "グラフに表示するデータの数を指定します。単位は件数。",
            dark_mode: "起動時のダークモードの有効/無効を指定します。",
          },
          data_logging: {
            data_log_dir: "ロギングの保存先ファイル名を指定します。ソフトウェアのexeが存在するディレクトリ上にファイルを生成します。",
            data_log_filename: "ロギングによって生成されたファイルの接頭辞を指定します。日時と拡張子が自動的に補完されます。例：log_20220101_1010.csv",
          },
        },
        values: {
          interface: {
            update_interval_sec: 0.5,
            graph_max_display: 100,
            dark_mode: false,
          },
          data_logging: { data_log_dir: "store", data_log_filename: "log" },
          data_list: {
            dummy_0: {
              display_name: "ダミー0",
              unit: "V",
              safe_range_min: -10000,
              safe_range_max: 10000,
            },
            dummy_1: {
              display_name: "ダミー1",
              unit: "A",
              safe_range_min: 999998,
              safe_range_max: 999999,
            },
            dummy_2: {
              display_name: "ダミー2",
              unit: "km",
              safe_range_min: -10000,
              safe_range_max: 10000,
            },
          },
        },
      };
      const connection_list = {
        COM0: { name: "通信ポート (COM0)", type: "Serial", response: "None", connected: false },
        COM1: { name: "通信ポート (COM1)", type: "Serial", response: "None", connected: true },
        COM2: { name: "通信ポート (COM2)", type: "Serial", response: "None", connected: false },
        "00:00:00:00:00:00": { name: "DEVICE0", type: "Bluetooth", response: "None", connected: false },
        "00:00:00:00:00:01": { name: "DEVICE1", type: "Bluetooth", response: "None", connected: false },
        "00:00:00:00:00:02": { name: "DEVICE2", type: "Bluetooth", response: "None", connected: false },
        "00:00:00:00:00:03": { name: "DEVICE3", type: "Bluetooth", response: "None", connected: false },
      };

      document.addEventListener("DOMContentLoaded", (event) => {
        document.getElementById("main_iframe").onload = () => {
          // 初期起動時の設定
          document.getElementById("main_iframe").contentWindow.Get_Initial_Settings(dummy_settings);
          document.getElementById("main_iframe").contentWindow.reload_connection_list(connection_list, (clear_all = true));

          // 定期動作時の処理
          setInterval(() => {
            let dummy_data = {};
            Object.keys(dummy_settings.values.data_list).forEach((key) => {
              dummy_data[key] = Math.round(Math.sin(new Date().getTime() / 150) * 100);
            });
            document.getElementById("main_iframe").contentWindow.Data_PY2JS(dummy_data);
          }, 30);
        };
      });
    </script>
  </body>
</html>
